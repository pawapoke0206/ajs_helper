# **JP1/AJS Helper Tool**

## **概要**

JP1/AJS (Automatic Job Management System) の運用・解析業務を効率化するために開発したGUIツールです。
SSH経由でサーバー上の定義やスクリプトを取得し、複雑に入り組んだジョブネットの構造や、ファイル入出力に基づく依存関係を可視化します。  
主にAIX/Linux環境上の銀行システム運用において、影響調査やリカバリ対応の工数を削減する目的で使用しています。

## **主な機能**

1. **定義取得・環境間コンバート**  
   * ajsprint 結果を取得し、本番・検証・開発環境間の定義差異（ユニット名やパスの違いなど）を吸収して変換出力。  
2. **定義回復 (Recover)**  
   * 特定のユニット定義をローカルからSSH経由でリカバリ（ajsdefine）実行。  
3. **入出力解析 (I/O Analysis)**  
   * ジョブが実行するシェルスクリプトを解析し、Input/Outputファイルを特定。  
   * 変数展開や**共通環境変数定義ファイル**を読み込んでシミュレートし、動的なパス解決を実現。  
4. **依存関係・影響範囲の追跡**  
   * 単なるジョブネットの前後関係だけでなく、「ファイル」を介したジョブ間の真の依存関係を逆引きで探索。

## **技術的こだわり・実装ロジック**

本ツールの開発において、特に注力したアルゴリズムと設計思想です。

### **1\. 入出力解析エンジン**

ジョブが扱うファイルパスを特定するため、以下の3段階の解析ロジックを実装し、「自動化の利便性」と「業務の確実性」を両立させました。

* **静的解析 (正規表現)**: シェルスクリプト内の入出力パターン（IN\_FILE=... やコマンド引数など）を正規表現で抽出。  
* **変数解決シミュレーション**: シェル内で export される変数や、**外部の共通設定ファイル**をパースし、${VAR}/filename.txt のような動的なパスを実際の値に展開。  
* **例外ルールの注入 (Manual Override)**: スクリプトの静的解析だけでは特定困難なケースに対応するため、JSON形式で手動ルール（例外定義）を注入できる仕組みを実装。これにより解析精度を100%に近づけています。

### **2\. ファイルレベルでの依存関係特定**

JP1標準の機能では「ジョブネットAの次にジョブネットBが動く」ことは分かりますが、「ジョブAが出力したファイルを、ジョブBが入力しているか」までは分かりません。  
本ツールでは、前述のI/O解析結果とJP1のネスト構造を組み合わせ、グラフ理論ライブラリ (NetworkX) を用いて\*\*「特定のファイルが欠損した場合に影響を受けるジョブ」\*\*をファイルレベルでトレースすることを可能にしました。

### **3\. 定義の『再構成』と『部分抽出』技術**

JP1の定義ファイルは独自のネスト構造を持っており、単純な切り出しでは整合性が取れなくなります。  
本ツールでは、テキスト処理ではなく論理構造として定義を解析することで、「依存関係のある必要なユニットだけを抽出」し、かつ「そのままJP1に再登録（回復）可能な完全なフォーマットで再構築する」 ロジックを実装しました。  
これにより、膨大な全量定義の中から、修正や調査に必要な最小限のパーツだけを安全に取り扱うことを可能にしています。

## **技術スタック**

* **言語**: Python 3.x  
* **GUI**: Tkinter  
* **SSH接続**: Paramiko  
* **データ構造解析**: NetworkX  
* **帳票出力**: OpenPyXL  
* **動作環境**:  
  * Client: Windows  
  * Server: AIX / Linux (RHEL等)

## **セットアップと実行方法**

### **1\. 必要ライブラリのインストール**

pip install \-r requirements.txt

### **2\. 設定ファイルの準備**

機密情報を含まないサンプルファイル (\_sample) が同梱されています。  
実行環境に合わせてファイル名を変更し、環境情報を設定してください。

* config\_sample.json → config.json （環境変数の定義など）  
* AJS\_trans\_sample.prm → AJS\_trans.prm （環境間コンバート用パラメータ）  
* io\_exceptions\_sample.json → io\_exceptions.json （解析例外ルール）

### **3\. 実行**

python ajs\_main.py

## **ディレクトリ構成**

* ajs\_main.py: アプリケーションのエントリーポイント  
* ajs\_constants.py: 定数定義  
* **Logic Modules**:  
  * ajs\_inout\_logic.py: 入出力解析ロジック  
  * ajs\_depend\_logic.py: 依存関係解析ロジック  
  * ajs\_rel\_logic.py: 先行関係解析・グラフ構築ロジック  
  * ajs\_print\_logic.py: 定義取得・変換ロジック  
  * ajs\_define\_logic.py: 定義回復ロジック  
  * ajs\_exception\_editor.py: 例外ルールエディタ  
* **Config Files** (以下はサンプルのみ公開):  
  * config.json: 環境依存の設定  
  * AJS\_trans.prm: 定義変換テーブル  
  * io\_exceptions.json: 解析例外ルール

## **免責事項**

本ツールは個人のポートフォリオとして公開しているものであり、実環境での動作を保証するものではありません。